name: Build on host
on: 
  workflow_call:
    secrets:
      vaultToken: 
        description: 'vault.token'
        required: true

      vaultUri:
        description: 'vault.uri'
        required: true

      vaultPath:
        description: 'vault.path'
        required: true

      secretsPath:
        description: 'SECRETS_PATH'
        required: true
  
jobs:
  host_build:
    environment: ${{ github.event.inputs.environment || 'native-image' }}
    runs-on: [self-hosted]
    steps:      
      - name: Checkout
        uses: actions/checkout@v3.3.0
        
#       - name: Set env
#         run: |
#           echo "vault.token=${{ secret.vault_token }}" >> $GITHUB.ENV
#           echo "vault.token=${{ inputs.vault_token }}" >> $GITHUB.ENV
#           echo "vault.token=${{ inputs.vault_token }}" >> $GITHUB.ENV
#           echo "vault.token=${{ inputs.vault_token }}" >> $GITHUB.ENV
       
      - name: Build native image
        env: 
          vault.token: ${{ secrets.vaultToken }}
          vault.uri: ${{ secrets vaultUri }}
          vault.path: ${{ secrets.vaultPath }}
          SECRET_PATH: ${{ secrets.secretsPath }}
        run: |
          mvn -Pnative,nativeTest package -DskipTests
